<?php
$servername = "localhost"; 
$username = "root";
$password = "4z@auGqVnPPDNxFBq#"; 
$database = "IDNPentest"; 

$connection = mysqli_connect($servername, $username, $password, $database);
if (!$connection) {
    die("Connection failed: " . mysqli_connect_error());
}
$id = $_GET['id'] ?? '1';
// Vulnerable SQL query
$query = "SELECT username, email FROM user_data WHERE id = '$id'";
echo "<p>SQL Query: $query</p>";
// Execute the query
$result = mysqli_query($connection, $query);
// Fetch the result
$row = mysqli_fetch_assoc($result);

?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLi Blind Lab</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container">
        <h1 class="mt-5">Blind SQL Injection (Time Based) Labs</h1>
        <p class="lead">Masukkan ID untuk melihat profile dari pengguna.</p>

        <form method="GET" action="sqli_blind.php" class="mb-3">
            <div class="mb-3">
                <label for="id" class="form-label">User ID:</label>
                <input type="text" class="form-control" id="id" name="id" placeholder="Enter User ID">
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>

        <div class="card">
            <div class="card-body">
                <?php
                // Display the user's profile
                if ($row) {
                    echo "<h5 class='card-title'>Nama: " . htmlspecialchars($row['username']) . "</h5>";
                    echo "<p class='card-text'>Email: " . htmlspecialchars($row['email']) . "</p>";
                } else {
                    echo "<p class='card-text text-danger'>User not found.</p>";
                }
                ?>
            </div>
        </div>
        <div class="card mt-4">
        <div class="card-header">
             <h4>Solution</h4>
        </div>
        <div class="card-body">
            <p>1. Halaman ini memiliki fitur input user ID untuk menampilkan profil pengguna. Jika pengguna memasukkan ID yang valid, informasi nama dan email dari pengguna tersebut akan ditampilkan. Jika ID tidak valid, halaman akan menampilkan pesan <code>User not found</code>.</p>
            <p>Daftar pengguna</p>
            <img src="user_data_table.png" alt="" width="480px">
            <p>2. Untuk mengeksploitasi kerentanan SQL Injection tipe Time-Based, kita dapat memasukkan payload yang menyebabkan delay pada database. Hal ini memungkinkan kita untuk mengetahui apakah suatu kondisi benar atau salah berdasarkan waktu respon.</p>
            <p>3. Contoh payload: <code>1' AND IF(SUBSTRING(database(),1,1)='I', SLEEP(5), 0)--</code>. Payload ini memeriksa apakah huruf pertama dari nama database adalah 'I'. Jika benar, maka database akan tidur selama 5 detik sebelum merespon.</p>
            <p>4. Dengan memasukkan payload tersebut pada parameter <code>id</code>, kita dapat menentukan karakter demi karakter dari nama database berdasarkan perbedaan waktu respon. Misalnya, kita dapat memulai dengan memasukkan <code>1' AND IF(SUBSTRING(database(),1,1)='I', SLEEP(5), 0)--</code> pada URL seperti <code>?id=1' AND IF(SUBSTRING(database(),1,1)='I', SLEEP(5), 0)--</code>.</p>
            <p>5. Jika halaman membutuhkan waktu lebih lama dari biasanya untuk memuat, itu berarti kondisi pada payload benar, yaitu huruf pertama dari nama database adalah 'I'. Proses ini bisa diulangi dengan menyesuaikan nilai dalam <code>SUBSTRING()</code> untuk mengungkap seluruh nama database.</p>
        </div>
        </div>
        <br>
        <br>
        <!-- Kembali Ke halaman utama -->
        <div class="text-center">
        <a href="index.php" class="btn btn-info my-4">Kembali ke Main Page</a>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>

<?php
// Close the connection
mysqli_close($connection);
?>